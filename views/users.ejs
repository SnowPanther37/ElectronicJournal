<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Пользователи</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <link rel="stylesheet" href="/css/cafedras.css" />
  <link rel="stylesheet" href="/css/profile.css" />
  <%- include ('./partials/bootstrap.ejs') %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="/js/navbar.js"></script>
  <style>
        .navbar{
          background-color: black !important;
          display: flex;
          flex-wrap: wrap;
        }
        .navButton {
  border-color: white;
}
.navButton {
  background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(255,255,255)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 8h24M4 16h24M4 24h24'/%3E%3C/svg%3E");
}
  </style>
  </head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-transparent fixed-top">
    <div class="container">
      <a class="navbar-brand logoTitle" href="/">Voodle</a>
      <%if(user){%>
  
      <%}%>
      <button
        class="navbar-toggler navButton"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <%if(user){%>
          <li class="nav-item active">
            <a class="nav-link" href="/"
              >ИГХТУ <span class="sr-only">(current)</span></a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/profile">Профиль</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cafedras">Кафедры</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/prepods">Преподаватели</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/prepods">Пользователи</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/task-manager">Занятия</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/logout">Выйти</a>
          </li>
          <%}else{%>
          <li class="nav-item">
            <a class="nav-link" href="/login">Войти</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup">Зарегистрироваться</a>
          </li>
          <%}%>
        </ul>
      </div>
    </div>
  </nav>
  <h1 style="color: white; margin-top: 70px; margin-left: 20px; font-weight: bold; font-size: 2em;letter-spacing: 1px;">Пользователи:</h1>
  <ul>
    <% if (users) { %>
      <% users.forEach(({ id, firstName, lastName, isStudent, isAdmin, isPrepod, course, group }) => { %>
        <li>
          <article style="border-radius: 10px; margin-top: 15px;margin-left: 15px; margin-right: 15px; margin-bottom: 10px;">
            <h2>
              <a href="/users/<%= id %>"><%= firstName %> <%= lastName %></a>
              <a><% if (isPrepod) { %> Преподаватель <% } %></a>
              <a><% if (isStudent) { %> Студент <%= course %>/<%= group %><% } %></a>
              <a style="color: red;"><% if (isAdmin) { %> Администратор <% } %></a>
              <a style="float:right; margin-right: 60px; margin-top: 15px; font-size: 18px;"<% if (user.isAdmin) { %>href="/edit-user/<%= id %>">РЕДАКТИРОВАТЬ<%}%></a>
              <%if(user.isAdmin){%>
                <button class="btn-delete" data-id="<%= id %>">
                  <i class="fas fa-trash-alt" data-id="<%= id %>"></i>
              </button>
              <%}%>
            </h2>
          </article>
        </li>
      <% }) %>
    <% } %>
  </ul>
  <script>
    document.addEventListener('click', (e) => {
      const id = e.target?.dataset?.id || null;
      if (id) {
        fetch(`/users/${id}`, {
          method: 'DELETE', 
        }).then(() => {
          window.location.reload();
        });
      }
    });
    $(document).ready(function () {
    var size = 90,
        newsContent = $('.trim'),
        newsText = newsContent.text().trim(); // ◀
    if(newsText.length > size) {
      newsContent.text(newsText.slice(0, size) + ' ...');
    }
  });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Кафедры</title>
  <link rel="stylesheet" href="/css/cafedras.css" />
  <link rel="stylesheet" href="/css/profile.css" />
  <%- include ('./partials/bootstrap.ejs') %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="/js/navbar.js"></script>
  <style>
        .navbar{
          background-color: black !important;
          display: flex;
          flex-wrap: wrap;
        }
        .navButton {
  border-color: white;
}
.navButton {
  background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(255,255,255)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 8h24M4 16h24M4 24h24'/%3E%3C/svg%3E");
}
  </style>
  </head>
<body>
        <nav class="navbar navbar-expand-lg navbar-light bg-transparent fixed-top">
          <div class="container">
            <a class="navbar-brand logoTitle" href="/">Voodle</a>
            <%if(user){%>
        
            <%}%>
            <button
              class="navbar-toggler navButton"
              type="button"
              data-toggle="collapse"
              data-target="#navbarNav"
              aria-controls="navbarNav"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav ml-auto">
                <%if(user){%>
                <li class="nav-item active">
                  <a class="nav-link" href="/"
                    >ИГХТУ <span class="sr-only">(current)</span></a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/profile">Профиль</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/cafedras">Кафедры</a>
                </li>
                <%if(user.isAdmin){%>
                <li class="nav-item">
                  <a class="nav-link" href="/add-cafedra">Добавить кафедру</a>
                </li>
                <%}%>
                <li class="nav-item">
                  <a class="nav-link" href="/prepods">Преподаватели</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/task-manager">Занятия</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/logout">Выйти</a>
                </li>
                <%}else{%>
                <li class="nav-item">
                  <a class="nav-link" href="/login">Войти</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/signup">Зарегистрироваться</a>
                </li>
                <%}%>
              </ul>
            </div>
          </div>
        </nav>

  <h1 style="color: white; margin-top: 70px; margin-left: 20px; font-weight: bold; font-size: 2em;letter-spacing: 1px;">Кафедры:</h1>
  <ul>
    <% if (cafedras.length) { %>
      <% cafedras.forEach(({ id, title, createdAt, text, dekan, direction }) => { %>
        <li>
          <article style="border-radius: 10px; margin-left: 15px; margin-right: 15px; margin-bottom: 10px;">
            <h2>
              <a href="/cafedras/<%= id %>"><%= title %></a>
            </h2>
           
            <div class="info">
              <span style="color: white;"><%= createdAt.toLocaleDateString() %></span>
              <span style="color: white;">Декан: <%= dekan %></span>
            </div>
            <div>
              <span style="color: white;">Направление: <%= direction %></span>
            </div>
            <div>
              <%if(user.isAdmin){%>
              <button class="btn-delete" data-id="<%= id %>">
                <i class="fas fa-trash-alt" data-id="<%= id %>"></i>
            </button>
            <%}%>
          </div>
          </article>
        </li>
      <% }) %>
    <% } %>
  </ul>

  <script>
    document.addEventListener('click', (e) => {
      const id = e.target?.dataset?.id || null;
      if (id) {
        fetch(`/cafedras/${id}`, {
          method: 'DELETE', 
        }).then(() => {
          window.location.reload();
        });
      }
    });
    $(document).ready(function () {
    var size = 90,
        newsContent = $('.trim'),
        newsText = newsContent.text().trim(); // ◀
    if(newsText.length > size) {
      newsContent.text(newsText.slice(0, size) + ' ...');
    }
  });
  </script>
</body>
</html>
